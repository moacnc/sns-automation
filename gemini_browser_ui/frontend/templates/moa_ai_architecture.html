<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOA AI Architecture - System Overview</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .architecture-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);
        }

        .architecture-header {
            padding: 32px 40px;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--bg-secondary);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .back-btn:hover {
            background-color: var(--bg-primary);
            border-color: var(--accent-color);
            transform: translateX(-2px);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .logout-btn {
            padding: 8px 16px;
            background-color: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background-color: var(--bg-tertiary);
            border-color: var(--danger-color);
            color: var(--danger-color);
        }

        .architecture-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .architecture-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .architecture-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .content-wrapper {
            max-width: 1200px;
            margin: 0 auto;
        }

        .section {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }

        .section-icon {
            font-size: 32px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .section-content {
            font-size: 15px;
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .architecture-diagram {
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 32px;
            margin: 24px 0;
            text-align: center;
        }

        .diagram-layer {
            background-color: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin: 16px 0;
            transition: all 0.3s;
        }

        .diagram-layer:hover {
            border-color: var(--accent-color);
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(88, 166, 255, 0.1);
        }

        .layer-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .layer-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }

        .component-card {
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.3s;
        }

        .component-card:hover {
            border-color: var(--accent-color);
            box-shadow: 0 4px 16px rgba(88, 166, 255, 0.1);
        }

        .component-icon {
            font-size: 28px;
            margin-bottom: 12px;
        }

        .component-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .component-description {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 16px;
        }

        .tech-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .tech-badge:hover {
            border-color: var(--accent-color);
            background-color: rgba(88, 166, 255, 0.1);
        }

        .flow-arrow {
            font-size: 24px;
            color: var(--accent-color);
            margin: 12px 0;
        }

        @media (max-width: 768px) {
            .architecture-header {
                padding: 20px;
            }

            .architecture-title {
                font-size: 28px;
            }

            .architecture-content {
                padding: 20px;
            }

            .section {
                padding: 20px;
            }

            .component-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="architecture-container">
        <!-- Header -->
        <div class="architecture-header">
            <div class="header-content">
                <div class="header-top">
                    <a href="/" class="back-btn">
                        <span>←</span>
                        <span>Back to Chat</span>
                    </a>
                    <div class="user-info">
                        <img id="userAvatar" class="user-avatar" src="" alt="User" style="display: none;">
                        <span id="userName" class="user-name"></span>
                        <button class="logout-btn" onclick="logout()">Logout</button>
                    </div>
                </div>
                <h1 class="architecture-title">🏗️ MOA AI Architecture</h1>
                <p class="architecture-subtitle">
                    MOA (Mixture of Agents) 시스템의 전체 아키텍처와 핵심 컴포넌트를 설명합니다.
                </p>
            </div>
        </div>

        <!-- Content -->
        <div class="architecture-content">
            <div class="content-wrapper">
                <!-- System Overview -->
                <div class="section">
                    <div class="section-header">
                        <span class="section-icon">🎯</span>
                        <h2 class="section-title">System Overview</h2>
                    </div>
                    <div class="section-content">
                        <p>
                            MOA AI는 Gemini 2.5 Computer Use API를 활용한 AI 에이전트 시스템으로,
                            실제 브라우저를 제어하여 복잡한 웹 작업을 자동화합니다.
                            자연어 명령을 받아 웹 브라우저를 제어하고, 실시간으로 작업 진행상황을 모니터링할 수 있습니다.
                        </p>
                    </div>
                </div>

                <!-- Architecture Diagram -->
                <div class="section">
                    <div class="section-header">
                        <span class="section-icon">📊</span>
                        <h2 class="section-title">Architecture Layers</h2>
                    </div>
                    <div class="architecture-diagram">
                        <div class="diagram-layer">
                            <div class="layer-title">🌐 Frontend Layer</div>
                            <div class="layer-description">
                                HTML5, CSS3, JavaScript로 구성된 실시간 웹 인터페이스<br>
                                Google OAuth 인증, HTTP Polling 기반 실시간 업데이트
                            </div>
                        </div>
                        <div class="flow-arrow">↓</div>
                        <div class="diagram-layer">
                            <div class="layer-title">🔧 Backend Layer</div>
                            <div class="layer-description">
                                Flask 웹 프레임워크, RESTful API 엔드포인트<br>
                                세션 관리, OAuth 인증, 비동기 작업 처리
                            </div>
                        </div>
                        <div class="flow-arrow">↓</div>
                        <div class="diagram-layer">
                            <div class="layer-title">🤖 AI Agent Layer</div>
                            <div class="layer-description">
                                Gemini 2.5 Computer Use API 통합<br>
                                자연어 처리, 브라우저 자동화, 작업 실행
                            </div>
                        </div>
                        <div class="flow-arrow">↓</div>
                        <div class="diagram-layer">
                            <div class="layer-title">🖥️ Browser Control Layer</div>
                            <div class="layer-description">
                                Playwright 기반 브라우저 제어<br>
                                스크린샷 캡처, DOM 조작, 이벤트 시뮬레이션
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Core Components -->
                <div class="section">
                    <div class="section-header">
                        <span class="section-icon">⚙️</span>
                        <h2 class="section-title">Core Components</h2>
                    </div>
                    <div class="component-grid">
                        <div class="component-card">
                            <div class="component-icon">🌐</div>
                            <div class="component-title">Web Interface</div>
                            <div class="component-description">
                                사용자 친화적인 채팅 인터페이스로 AI 에이전트와 실시간 소통.
                                Google OAuth를 통한 안전한 인증 시스템.
                            </div>
                        </div>
                        <div class="component-card">
                            <div class="component-icon">🔐</div>
                            <div class="component-title">Authentication</div>
                            <div class="component-description">
                                Google OAuth 2.0 기반 인증 시스템.
                                Flask Session을 통한 세션 관리 및 사용자 정보 보호.
                            </div>
                        </div>
                        <div class="component-card">
                            <div class="component-icon">🤖</div>
                            <div class="component-title">AI Agent</div>
                            <div class="component-description">
                                Gemini 2.5 Computer Use API를 활용한 지능형 에이전트.
                                자연어 명령 이해 및 복잡한 웹 작업 수행.
                            </div>
                        </div>
                        <div class="component-card">
                            <div class="component-icon">🎮</div>
                            <div class="component-title">Browser Controller</div>
                            <div class="component-description">
                                Playwright 기반 브라우저 자동화 시스템.
                                클릭, 입력, 스크롤 등 모든 브라우저 작업 제어.
                            </div>
                        </div>
                        <div class="component-card">
                            <div class="component-icon">📡</div>
                            <div class="component-title">Real-time Updates</div>
                            <div class="component-description">
                                HTTP Polling 방식의 실시간 상태 업데이트.
                                작업 진행상황, 에이전트 메시지 실시간 전송.
                            </div>
                        </div>
                        <div class="component-card">
                            <div class="component-icon">📊</div>
                            <div class="component-title">Task Manager</div>
                            <div class="component-description">
                                작업 큐 관리 및 실행 제어.
                                동시 작업 방지, 작업 상태 추적 및 결과 반환.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Technology Stack -->
                <div class="section">
                    <div class="section-header">
                        <span class="section-icon">🛠️</span>
                        <h2 class="section-title">Technology Stack</h2>
                    </div>
                    <div class="section-content">
                        <h3 style="color: var(--text-primary); margin-bottom: 16px; font-size: 18px;">Frontend</h3>
                        <div class="tech-stack">
                            <span class="tech-badge">🌐 HTML5</span>
                            <span class="tech-badge">🎨 CSS3</span>
                            <span class="tech-badge">⚡ JavaScript (ES6+)</span>
                            <span class="tech-badge">📱 Responsive Design</span>
                        </div>

                        <h3 style="color: var(--text-primary); margin: 24px 0 16px; font-size: 18px;">Backend</h3>
                        <div class="tech-stack">
                            <span class="tech-badge">🐍 Python 3.11+</span>
                            <span class="tech-badge">🌶️ Flask</span>
                            <span class="tech-badge">🔐 Authlib (OAuth)</span>
                            <span class="tech-badge">📦 Flask-Session</span>
                            <span class="tech-badge">🌍 Flask-CORS</span>
                        </div>

                        <h3 style="color: var(--text-primary); margin: 24px 0 16px; font-size: 18px;">AI & Automation</h3>
                        <div class="tech-stack">
                            <span class="tech-badge">🤖 Gemini 2.5 API</span>
                            <span class="tech-badge">🎭 Playwright</span>
                            <span class="tech-badge">🧠 Computer Use API</span>
                        </div>

                        <h3 style="color: var(--text-primary); margin: 24px 0 16px; font-size: 18px;">Infrastructure</h3>
                        <div class="tech-stack">
                            <span class="tech-badge">☁️ Google Cloud Run</span>
                            <span class="tech-badge">🐳 Docker</span>
                            <span class="tech-badge">🔧 Environment Variables</span>
                            <span class="tech-badge">📝 Logging (Loguru)</span>
                        </div>
                    </div>
                </div>

                <!-- Data Flow -->
                <div class="section">
                    <div class="section-header">
                        <span class="section-icon">🔄</span>
                        <h2 class="section-title">Data Flow</h2>
                    </div>
                    <div class="section-content">
                        <ol style="padding-left: 20px; line-height: 2;">
                            <li><strong>사용자 입력:</strong> 웹 인터페이스에서 자연어 명령 입력</li>
                            <li><strong>인증 확인:</strong> Flask Session을 통한 사용자 인증 검증</li>
                            <li><strong>API 요청:</strong> RESTful API를 통해 백엔드로 명령 전송</li>
                            <li><strong>작업 큐:</strong> Task Manager가 작업을 큐에 등록 및 실행</li>
                            <li><strong>AI 처리:</strong> Gemini 2.5 API가 명령을 분석하고 작업 계획 수립</li>
                            <li><strong>브라우저 제어:</strong> Playwright가 실제 브라우저에서 작업 수행</li>
                            <li><strong>진행상황 업데이트:</strong> 실시간으로 프론트엔드에 상태 전송</li>
                            <li><strong>결과 반환:</strong> 작업 완료 후 결과를 사용자에게 표시</li>
                        </ol>
                    </div>
                </div>

                <!-- Security Features -->
                <div class="section">
                    <div class="section-header">
                        <span class="section-icon">🔒</span>
                        <h2 class="section-title">Security Features</h2>
                    </div>
                    <div class="component-grid">
                        <div class="component-card">
                            <div class="component-icon">🔐</div>
                            <div class="component-title">OAuth 2.0 인증</div>
                            <div class="component-description">
                                Google OAuth를 통한 안전한 사용자 인증.
                                비밀번호를 저장하지 않고 Google이 인증 관리.
                            </div>
                        </div>
                        <div class="component-card">
                            <div class="component-icon">🗝️</div>
                            <div class="component-title">세션 관리</div>
                            <div class="component-description">
                                Flask-Session을 통한 안전한 세션 관리.
                                파일 시스템 기반 세션 저장소 사용.
                            </div>
                        </div>
                        <div class="component-card">
                            <div class="component-icon">🔑</div>
                            <div class="component-title">API Key 보호</div>
                            <div class="component-description">
                                환경 변수를 통한 API 키 관리.
                                코드에 하드코딩하지 않아 보안 강화.
                            </div>
                        </div>
                        <div class="component-card">
                            <div class="component-icon">🛡️</div>
                            <div class="component-title">CORS 설정</div>
                            <div class="component-description">
                                Flask-CORS를 통한 교차 출처 요청 제어.
                                승인된 도메인만 API 접근 허용.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Future Enhancements -->
                <div class="section">
                    <div class="section-header">
                        <span class="section-icon">🚀</span>
                        <h2 class="section-title">Future Enhancements</h2>
                    </div>
                    <div class="section-content">
                        <ul style="padding-left: 20px; line-height: 2;">
                            <li><strong>웹소켓 통합:</strong> HTTP Polling을 WebSocket으로 대체하여 더 효율적인 실시간 통신</li>
                            <li><strong>작업 히스토리:</strong> 데이터베이스를 통한 작업 내역 저장 및 검색</li>
                            <li><strong>다중 브라우저 지원:</strong> Chrome, Firefox, Safari 등 다양한 브라우저 동시 제어</li>
                            <li><strong>스케줄링:</strong> 주기적인 작업 자동 실행 기능</li>
                            <li><strong>협업 기능:</strong> 여러 사용자가 동시에 작업을 공유하고 모니터링</li>
                            <li><strong>고급 AI 기능:</strong> 멀티모달 입력, 음성 명령, 이미지 기반 작업 지시</li>
                            <li><strong>성능 최적화:</strong> 캐싱, CDN 활용, 코드 스플리팅</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load user info
        async function loadUserInfo() {
            try {
                const response = await fetch('/api/user');
                const data = await response.json();

                if (data.logged_in) {
                    document.getElementById('userName').textContent = data.user.name;
                    if (data.user.picture) {
                        const avatar = document.getElementById('userAvatar');
                        avatar.src = data.user.picture;
                        avatar.style.display = 'block';
                    }
                } else {
                    window.location.href = '/login';
                }
            } catch (error) {
                console.error('Failed to load user info:', error);
                window.location.href = '/login';
            }
        }

        // Logout
        function logout() {
            window.location.href = '/logout';
        }

        // Initialize
        loadUserInfo();
    </script>
</body>
</html>
